# Báo cáo bài tập cuối kỳ Nhập môn An toàn thông tin

## Bài 1

### Xây dụng hệ mật trên đường cong Elliptic cho mục đích mã hóa và chữ ký số

Em sử dụng phương pháp tạo đường cong Elliptic là Barreto-Naehrig (BN) được mô tả ở [\[BN05\]](https://github.com/scipr-lab/ecfactory/blob/master/references/Barreto%20Naehrig%202005%20---%20Pairing-Friendly%20Elliptic%20Curves%20of%20Prime%20Order.pdf). Để sinh đường cong, em sử dụng thư viện [ecfactory](https://github.com/scipr-lab/ecfactory/) chạy trên Sage Math notebook. Code sinh đường cong ở file sage math notebook là [480bit_BN_Curve.ipynb](/part1/generating%20elliptic%20curve/480bit_BN_Curve.ipynb), có thể được xem trước ở [đây](/part1/generating%20elliptic%20curve/480bit_BN_Curve.html).

Đường cong $E$ được được xây dựng có phương trình $y^2 = x^3 + 139968$ định nghĩa trên trường $Z_p$ với $p$ là số nguyên tố. $E$ có số điểm $n$ là số nguyên tố có độ dài **480 bit**. Giá trị của $p$ và $n$ như sau:

```
p = 3121748550315991538214173699589534134746816072564600451419102228601975673027889400388457879547892172226543045096818024326803929600010118578056399
n = 3121748550315991538214173699589534134746816072564600451419102228601975671261042335610073746124023902317385879851778395454090705207338203955310073
```

Với bản tin cần mã hóa/ký là _"Chào mừng 20 năm thành lập trường ĐHCN."_, kết quả chạy hệ mật dựa trên đường cong $E$ ở trên như sau:

#### Hệ mật El Gamal trên đường cong Elliptic cho mục đích mã hóa:

Khóa công khai:<br>

```
P = (2628708152930118420921448954284099879138393451878172207317617502060174370336746282686317608095239524235056788545351452769993600430160983895115254, 274147431141426391789273636195704065353249318025906212392045025215445134478011917289706594228319451838568724471288294969240853169244648897034901)
Q = P * m = (226431370260333961348314634451111233813353734602793514091668989019585295842060139575237834768200746385683192928777227107606853410535133795405596, 1043363139058811875288754448639242552951095193181282789885705625304362929667979545704219551089584239619199134673386164019901388460826816866530429)
```

Trong đó: $P$ là điểm sinh của đường cong, $Q = P \cdot m$ với $m$ là khóa bí mật:

```
m = 2900851751762304631439143829416961288387144843633299922558609386221815197431757082210795280194679487748771717133869826452493005488172855519501402
```

Để mã hóa bản tin, đầu tiên, em chia văn bản thành các khối, sau đó em chuyển các khối này về dạng số trong hệ cơ số $base = 1114112$ là số ký tự trong bảng mã Unicode UCS4, là phiên bản Unicode trong máy em. Các khối có độ dài là $blocklength = \lfloor log_{base}(p) \rfloor$. Khi đó biểu diễn số $x$ của các khối sẽ luôn nhỏ hơn $p$[^1]. Cuối cùng em mã hóa các biểu diễn số của các khối thành bản mã bằng cách sử dụng thuật toán trong sách Cryptography: Theory and Practice, trang 292. Kết quả chia khối, số hóa và mã hóa như sau:

```
Văn bản ban đầu được chia ra thành các khối:
['Chào mừng 20 năm thành ', 'lập trường ĐHCN.']
Biểu diễn số của các khối:
[721955038760011778506439407402870365717799364829438783260323566288284753587978080975944607215261954476803945452918270077713772796444704, 546241735163159435803185205798035502246029422125149858913210944125916388810184353175925817390]
Kết quả mã hóa khối thứ nhất:
kP compressed = (316859666259579012189691973849379908439997704180486397824714016114454355655225619085139259130513044359533508464827370829131327958511215460091986, 0)
encrypted message = 721955038760011778506439407402870365717799364829438783260323566288284753587978080975944607215261954476803945452918270306023463976012516
Kết quả mã hóa khối thứ 2:
kP compressed = (2614191180963729758186053145437196540313314081106434264663977759680279560235471787078028412223075437875898183349729680723755458395438898390374099, 0)
encrypted message = 546241735163159435803185205798035502246029422125149858913210944125916388817538682729507103678
```

#### Hệ mật trên đường cong Elliptic cho mục đích chữ ký số

Em sử dụng thuật toán Elliptic Curve Digital Signature Algorithm để sinh chữ ký số. Kết quả chạy thuật toán như sau:

Khóa công khai:

```
P =(1989887806951317900087088218131198976540178272836090299070563556012688441322501165811360327548007752833762458988509941765089932288151892256455336, 1247673786565370379639029180100985342372914403365888607206833009495497260657912095819140567067847156066954858822488646721636117224869549677477273),
Q = P * m =(447895207251337040363801552095365456580986665176678361272671756409904303508593790632419731150501486294192626239011832530841221996556427843364284, 2442599676928091647825799293292551511163790180017648401426676690164894887328324574253255173139938813274787851795120529292055640106151706283325112)
```

Khóa bí mật:

```
m = 1529051152737973682905793002632980873111384312459278510386455151402200816851801696313418568835400204448868152264339700794874384259865287967837966
```

Chữ ký số:

```
r = 1907689972956525959531575978138768995800512941416005313572133861196086769224373282638341672839849439277303332820287350939925367892472736111619528,
s = 506108795715244856476521800127420646907107410094662761682111023668459156189404371208787633017601826348863382356170133764616113769143161276603217
```

### Xây dụng hệ mật RSA có độ dài khóa 3072 bit cho mục đích mã hóa và chữ ký số

Em sử dụng thư viện Cryptodome để tạo cặp số $p$ và $q$ làm tham số cho giải thuật. Để hệ mật sử dụng khóa có độ dài 3072 bit, em sinh ra $p$ và $q$ là 2 số nguyên tố có độ dài 1536 bit để modulus $n = p \cdot q$ của hệ mật có độ dài 3072 bit.

Kết quả chạy hệ mật trên bản tin _"Chào mừng 20 năm thành lập trường ĐHCN."_ như sau:

Tham số của hệ mật:

```
p = 1910274540145946749781523173843716317401157949153691076844770402022004672295188377160605230534823086858652994051170367199814160985410162093962829983538326107680686246248449941286661807490836888358482393841858315056949911833574972880000107853911627652965312735117202642552764943448754739227883045383512193025062850817050537824504877411421811678610675832306841840064313806524303128497818598780594965087219436978600789301212348427364095890332207005054079769997367337
q = 2312450540231551254696767527328770176049490409251509721266504948713929433320634494442874210853009546149674304972199319675030888783637256955371889758890934279856842047225829395243050049215943714576847847508623598347770819294895120215302115963778556760792501024012751272537665526335137520851916129425859359202496420772211265882230772763737968706461545509216452549174897553723485533531726532318301928143057170944645959721923622804876249522752665175431168510841245741
```

Khóa công khai:

```
e = 3428683428462096892045907709746270702883258818351934959724336494443624714414721832887797119463609554246719214952909920731462518642460035621518841313501691021803262404327047472741178523061639677442988389278716304138979743509112464062217930471705985055092661563264728239568018986621911257939499473007120720866934630228778893700376626868713158707479766015703919426339101343772224056990773651099154752586984133103306219685686734931694088635635328241034577757052944599645315745133828320567965515630367306995711192369281970779268310171882348992844645474339240563299794160372246343832936226041629970318667957472259940282342105015763543864776601774208713477665494289113396425795206230742503035095404560797326780876658695036434015396322035594207165887640631445875805818611108960084888996410339414705725155291600325158502028422271108562648101542089169074642004464509427601034472621195204907638248111211217717819594095608162863427357503
```

Khóa bí mật

```
d = 1879056507486996216142935353281527822260626681348240832984494383290939716832272297762960480287783982152852373248711889864647407952039870568397390705583509316482784683546370116904069752899451913013554920664267595079995897890508845295023516360268480839042757384488301899331167816586472547573643581414222210048950011628167750344113451305433749522886570008223648024441312875754347863930501856696711720402831228260370437892739407930468330668189265661409236231350134471005586954473024428634222390038835629016822952698107645065147246871763944339068887635198122046057005623745328077878867237595104139384550843341017781153282619652642853911754026648421025010914540470403241535671079021622094966123752741707438329306993817996383523371511717290203898873160990305665126676339711799978455031545635668728900054342037825555190414981788415181717441141003935081511275882359939991604312037828373116588131816285949655761452381938731093538415487
```

Để mã hóa, em cũng chia khối và số hóa các khối như mô tả ở phần hệ mật trên đường cong Elliptic. Kết quả chia khối, số hóa và mã hóa như sau:

```
Chia khối (chỉ có 1 khối vì modulus n có độ dài lớn):
['Chào mừng 20 năm thành lập trường ĐHCN.']
Biển diễn số của khối:
[4067914196276505126507327294116237626133088025967664557039112632526461340482411240027825632696089885999287753932762743570540739736329958993374810836738999214724041209563464130735278717417205938237327755844882550439178306152934801454]
Bản mã:
[3930583223827982453726375014161039262109388140203625494780161125136386948205945221301158813479087548226445735208967026003175992657545239934384511157800743656140487280860354034613122447397413492332742171457312093134789434929133449990925135015161136018613866727955491529795881256635014357730118113484086547889699228338031621868176812828934420875903586878548082449475547748049971227813663991539884294234377717717584383630554926591327560810654999166472235867888326396819379633937847954545882809848466405892163407337136773327252337948359734372182274621256326879642252664320823754403268709248048046874153084392377688917594506200169695936172734227246481168443909593172252625911993491765201112093209907806876688837251623202422361244870763674875917150991644091427290349573046199033222091946648646712939057941285763884889216211509113712044647915788639339325068677654669669576518485810580877904505597457978306728793932495267489810671459]
```

Chữ ký số của bản tin:

```
140290949324640215047950577682776277797861127425859394591461320653204797367805538842263192682638781342277805388685165908020368311062053685478529941224742792868359284440546526582521653310543416272344713139046346293030740397922316198931456531895077072334555762957471562918818892406066178655091632164073375892521672870147479729680337679636656579478948509719255967028848818533539419378559628715997556472055458193318115586632982236925627723408687872792988280889825881141983428658203103912789846015807628852087963758452184871037980030169425262781036289436438238937899698893347643136697142428188358095842848056942396469438873626653783462824358731468797159696063793838557249705097757199158997133599293081823156394355200335497790994764075403449658148016350827248617288942525726403112735991409148814330388368678902728040515717342151638467244167161148088130311369602154850910606081551950407305311595378332635691350264018417017939935163
```

### Xây dựng hệ mật El Gamal có độ dài khóa 1024 bit cho mục đích mã hóa và chũ ký số

Em cũng sử dụng thư viện Cryptodome để sinh cặp tham số $p$ và $g$ cho hệ mật El Gamal, trong đó $p$ là số nguyên tố mà trên trường $Z_p$ hệ mật được định nghĩa, và $g$ là một điểm sinh của nhóm nhân $Z_p^*$. Vì việc sinh tham số $p$ có độ dài 1024 bit chạy mất một vài phút, em có lưu lại một cặp tham số $p$ và $g$ được tạo sẵn trong file [elgamal.txt](/part1/inputs/elgamal.txt) (dòng đầu là $p$, dòng sau là $g$). Cặp tham số được tạo sẵn là:

```
modulus: p = 119762477999026584601920020061019188333983083887549998248085954263081526299442961031967210886704874653385351356091728475248281807620274223196103646352140285506526989094297418787942029952571248251071147518120890725416580585507203260669504887164872416814645783198780205426172545567710692407745124032002537078127
generator: g = 48284855524439699495898023006563424030358593486759306222835365587132537093155454330818417929870034764124681996097797615491273259434376418715441533330981798438943486880548277650555105721676141967585029002887810455940775854835212592689992550196504381797925927589399952737304791375230064448401121275251290177082
```

Kết quả chạy trên cặp tham số được tạo sẵn đó như sau:

Khóa công khai $\beta$:

```
beta = 87893867143925426337113297779031637277869680173454720596602053278301646486552421452434569484287665084360445923307658026561142080699688009833479703969780294592224217701486140960600224551701219818395148475129825227110194661030034904782450893257828108561183785312279110327740712787412214654696184955837400094007
```

Khóa bí mật:

```
a = 103837954235879406448669817062949156352888589949743648102713847261848425636788809201400262685124943049507949406533823898211912297605978594307808689699459173389057210878023793778334240767660213277508251047051704636557726290949824764556971903905401827999086434944122858807116180093759316033942794806936877810561
```

Em cũng thực hiện chia khối, số hóa khối và mã hóa trên khối như các phần trên. Kết quả chia khối và mã hóa như sau:

```
Chia khối (chỉ có 1 khối vì modulus p có độ dài lớn):
['Chào mừng 20 năm thành lập trường ĐHCN.']
Số hóa khối:
[4067914196276505126507327294116237626133088025967664557039112632526461340482411240027825632696089885999287753932762743570540739736329958993374810836738999214724041209563464130735278717417205938237327755844882550439178306152934801454]
Bản mã:
y1 = 72124884163634459920040527800898965201757633885181147665250912423289510723376622280418544003387364279709395795689003039368438988232312274863215243864755699084883130616267394828089565109551505436960691669122350849224169309359189544123248409697206226403971110033161453968491427513116263547119657801427227437123,
y2 = 101219509249400217101191956602581529151405878374568043774152887342586593162512814124391884344634965801310751279174805118772634816434170964411598323496749835868913889445198532487460675261458949467169523340806153205822257847200231162982924544380747813813798170492961780842670552455993510208750372460620698629594
```

Chữ ký số (cặp 2 số $\gamma$ và $\delta$) của bản tin:

```
gamma = 108802682361141838704879126348247136212259314317721078256990786004214711224400488197700626203300199730304860394108407609386296614503271928036944367633876268218339127642952266085630928465896176475769188292179013903495577855552727547647119994922762179111726225906501112984975574748548048623269097300747694565165
delta = 27443942231940777710375975469302398102092940341837519984650423900203733601924773980680033663425234797102898393596371574939091160645719357434356288699373834032432473097765176609365897519190220680953561944082556388719300062243349796308809045163918789291626649433655817143759543559608027343273686894987368529047
```

Trên một cặp tham số $p$ và $g$ khác là:

```
modulus: p = 171698545202946215643730160112936669540543546703717751341073150482286134370743100751755980251100270474806745783055923726942849816381203906270094227648554553928105993444181140669330329441175883213820284653055255697524218302104364910519890135687589624626416602881797622375554289220839053657865768795015146166983
generator: g = 117040880535358886412121785633898777083194675630696504799026742833354190793444022314680599846589957033435760384904218681271961064739343927400386930326521189982848880894834122614665434453985391832788120523247356759542574192636105285356614269086204547495241379249338997062979870891797891772558463640021025832181

public key: beta = 81230856231673609802246678619453769609628951449007715460614202744911805175848862122849567432907585209542064071045164034866905636776304848123144625367225205945647470908479838213564887797372646170319224554890308460986759476378641630057868930535655644061426928856585392455353493245522691121324777851252532766934

private key: a = 111121362167841783074079438095008119741096830050636617994113318320895325878860307939881538113881210032184033086438178566645802572215811592573528026310394348490989301484953662085402510567172843134365130106704739225785412980376773067414439596388570845277727872854143982219424173569727721157950915228467295436849

Chia khối (chỉ có 1 khối):
['Chào mừng 20 năm thành lập trường ĐHCN.']
Số hóa:
[4067914196276505126507327294116237626133088025967664557039112632526461340482411240027825632696089885999287753932762743570540739736329958993374810836738999214724041209563464130735278717417205938237327755844882550439178306152934801454]

Bản mã:
y1 = 152101376966686614344654344959770782880418691640647240290081000780032662732119102193527403547835720694611809469449266311001746581940657663304342229797840152257040780790427872825199533356113097775246013526674450565320984917341737194834278151094589925964063026197482706417643399110228898745609197598384927877744,
y2 = [138040497325148370226713333163719178720263911901716963427851162304748270561549477937542697815191965629746468085061980936843597493891526541155540528679012411980810613457299089940381395276309350629423585168808267853185759042265074206195958661563404137764062248966882936603547644491746898782285989057403085718538]

chữ ký số:
gamma = 80513900729861161259567454529368726532190642866478502996126900585616906128882515584729158302296117961792544829097190893847772096587900207900800647136583775350193357522654515702401087392146483671076079893681795409923378505587062082089123180292372314237105963361526395845208484956874328804444398647920267079498,
delta = 14518342834124192789649507613015916156254778341049916988733604479373071490186599723735588104665004583685420374707387781528331011978478224412160185841364123254341454954037547989276147471867750672103700167242115629514640542010800609256717367700132781451268396717078335742086982710873829250377420600009712361938
```

[^1]: Độ dài của biểu diễn một số $x$ trong hệ cơ số $b$ là $\lfloor log_b(x) \rfloor + 1$. Do đó độ dài của biểu diễn của $p$ trong hệ cơ số $base$ là $\lfloor log_{base} (p) \rfloor + 1$. Vì em lấy độ dài khối là $\lfloor log_{base} (p) \rfloor$, tức nhỏ hơn $1$ so với độ dài của biểu diễn của $p$, nên biểu diễn số $x$ của các khối sẽ luôn nhỏ hơn $p$.
